<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>RGC Screener</title>
		<style>
			.redborder{
				outline: 3px solid red;
			}
		</style>
		<link href="Website/css/bootstrap.min.css" rel="stylesheet">
		<link href="Website/css/app.css" rel="stylesheet">
	</head>
	<body>
		<ul class="nav nav-tabs" style="display:none" role="tablist" id="myTab">
			<li role="presentation" class="active"><a href="#screener" aria-controls="screener" role="tab" data-toggle="tab">screener</a></li>
			<li role="presentation"><a href="#results" aria-controls="results" role="tab" data-toggle="tab">results</a></li>
		</ul>
		<div class="container" style="width:100%">
			<div class="tab-content">
				<div role="tabpanel" class="tab-pane active" id="screener">
					<div style="padding-top: 20px; padding-bottom: 20px" class="container">
					</div>
					<form id = "anxiety-form">
						<div id = "questions"></div>
						<button type="submit" class="btn btn-block btn-default">Submit</button>
					</form>
				</div>
				<div role="tabpanel" class="tab-pane" id="results">
					<div style="padding-top: 20px; padding-bottom: 20px" class="container">
						<h2 class = 'center-block'>Results</h2>
						<p>You have just filled in the GAD-7 questionnaire which screens for anxiety. This is usually a helpful guide to studentâ€™s stress and anxiety levels.
						</p>
						<hr style="background:#BBBBBB; border:0; height:1px" />
					</div>
					<div class = 'results-analysis' id = 'minimal-anxiety'>
						<h2>Test results: minimal anxiety</h2>
						You are a remarkably well-balanced individual.
					</div>
					<div class = 'results-analysis' id = 'mild-anxiety'>
						<h2>Test results: mild anxiety</h2>
						Monitor the anxiety level for the time being, and repeat GAD-7 at a later time. After all, small problems frequently get better by themselves.
					</div>
					<div class = 'results-analysis' id = 'moderate-anxiety'>
						<h2>Test results: moderate anxiety</h2>
						Further evaluation is recommended.
						Consider counselling.
						You can contact Raffles Guidance Centre, which has a team of experienced counselors and a psychologist at rgc@ri.edu.sg, or call 6319 3149 for more information. 
					</div>
					<div class = 'results-analysis' id = 'severe-anxiety'>
						<h2>Test results: severe anxiety</h2>
						Active treatment is highly recommended!
						You can contact Raffles Guidance Centre, which has a team of experienced counselors and a psychologist at rgc@ri.edu.sg, or call 6319 3149 for more information.
					</div>
					<div>
						<h3>Scores from the questionnaire</h3>
						<p>
							For ease of interpretation, GAD-7 scores can be grouped into four bands:
						</p>
						<div class = "col-md-12 col-sm-12">
							<table style="padding:10px">
								<thead>
									<th>GAD-7 score</th>
									<th>Anxiety serverity</th>
									<th>Recommended Action</th>
								</thead>
								<tbody>
									<tr>
										<td>0-4</td>
										<td>None-minimal</td>
										<td>None</td>
									</tr>
									<tr>
										<td>5-9</td>
										<td>Mild</td>
										<td>Watchful waiting, repeat GAD-7 at a later stage</td>
									</tr>
									<tr>
										<td>10-14</td>
										<td>Moderate</td>
										<td>Further evaluation is recommended. Consider counselling</td>
									</tr>
									<tr>
										<td>15-21</td>
										<td>Severe</td>
										<td>Active Treatment</td>
									</tr>
								</tbody>
							</table>
							<p dir="ltr"><u>What Next?</u></p>

							<p dir="ltr"><span style="background-color:transparent; color:#000000; font-family:times new roman; font-size:16px">If you still have concerns, here are some suggestions about what you could do:</span></p>

							<p dir="ltr"><span style="background-color:transparent; color:#000000; font-family:times new roman; font-size:16px">You can contact Raffles Guidance Centre, which has a team of experienced counselors and a psychologist at rgc@ri.edu.sg, or call 6319 3149 for more information. &nbsp;Printing this report could help you explain your concerns and ask for advice &ndash; for example, you could show the report to someone at RGC. </span></p>

							<p dir="ltr"><br />
							<strong>Time may tell</strong><br />
							<span style="background-color:transparent; color:#000000; font-family:times new roman; font-size:16px">When there are difficulties, it isn&#39;t always easy to decide whether to do something about them or not. On the one hand, it often seems a good idea to tackle problems as soon as possible &ndash; but then again, small problems frequently get better by themselves. Indeed, making a big fuss about small problems can sometimes make things worse. The table below is a guide as to when to act, and when just to keep a careful eye on things:&nbsp;</span></p>

							<div dir="ltr" >
							<table style="border-collapse:collapse; border:none">
								<tbody>
									<tr>
										<td style="vertical-align:middle">
										<p dir="ltr"><strong>In favour of just keeping an eye on things:</strong></p>
										</td>
										<td style="vertical-align:middle">
										<p dir="ltr"><strong>In favour of acting now:</strong></p>
										</td>
									</tr>
									<tr>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#0000ff; font-family:times new roman; font-size:16px">Scores are within the mild range</span></p>
										</td>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#ff0000; font-family:times new roman; font-size:16px">Scores are in the moderate to severe range</span></p>
										</td>
									</tr>
									<tr>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#0000ff; font-family:times new roman; font-size:16px">Difficulties have been present for just a few days</span></p>
										</td>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#ff0000; font-family:times new roman; font-size:16px">Difficulties have been present for more than half the time in the past 2 weeks</span></p>
										</td>
									</tr>
									<tr>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#0000ff; font-family:times new roman; font-size:16px">Student is not upset</span></p>
										</td>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#ff0000; font-family:times new roman; font-size:16px">Student is upset</span></p>
										</td>
									</tr>
									<tr>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#0000ff; font-family:times new roman; font-size:16px">Everyday life is not much affected</span></p>
										</td>
										<td style="vertical-align:middle">
										<p dir="ltr"><span style="background-color:transparent; color:#ff0000; font-family:times new roman; font-size:16px">Everyday life is definitely affected</span></p>
										</td>
									</tr>
								</tbody>
							</table>
							</div>

							<p>&nbsp;</p>

							<p dir="ltr"><span style="background-color:transparent; color:#000000; font-family:times new roman; font-size:16px">Alternatively, you may decide to save the report for your reference, and then complete a new questionnaire in the future. This will enable you to be able to see how things have changed later on.</span></p>

						</div>
					</div>
					<div>
						<button class = "btn btn-default" onclick = "resetScreener()">Back to screener</button>
					</div>
				</div>
			</div>
			
		</div>
		<div style="margin:20px">Developed by Drs. Robert L. Spitzer, Janet B.W. Williams, Kurt Kroenke and colleagues, with an educational grant from Pfizer Inc. No permission required to reproduce, translate, display or distribute.
		</div>
		<script type = "text/template" id = "questiontemplate">
		<div class = "container" style = "width:100%" id = "<%= ['question', qnsid, 'wrapper'].join('-') %>">
			<p>
				<%= qnsid+1 %>)
				<%= qns.question %>
			</p>
			<div class="row col-md-12 col-sm-12"  data-toggle="buttons">
				<%
					print(_.map(qns.options, function(ans, id){
						return optcomp({answer: ans.answer, 
							optname: ["question",qnsid].join("-"), 
							value: id,
							optid: ["question",qnsid,"option", id].join("-")
						});
					}).join("\n"));
				%>
			</div>
		</div>
		<hr style="background:#BBBBBB; border:0; height:1px" />
		</script>
		<script type = "text/template" id = "answertemplate">
		<div class = "btn-group col-md-3 col-sm-3">
		<label class="btn btn-primary center-block col-sm-12 col-md-10 col-md-offset-1" style="margin:10px;">
			<input type="radio" name="<%= optname %>" id="<%= optid %>" value="<%= value %>" autocomplete="off">
			<%= answer %>
		</label>
		</div>
		</script>


		<script src="Website/js/jquery-1.11.2.min.js"></script>
		<script src="Website/js/bootstrap.min.js"></script>
		<script src="Website/js/underscore-min.js"></script>
		<script type="text/javascript">
		var Qns =[{question: "Feeling nervous, anxious or on edge"}, {question: "Not being able to sleep or control worrying"}, {question: "Worrying too much about different things"}, {question: "Trouble relaxing"}, {question: "Being so restless that it is hard to sit still"}, {question: "Becoming easily annoyed or irritable"}, {question: "Feeling afraid, as if something awful might happen"}];
		var Ans = [{answer: "Not at all"}, {answer: "Several days"}, {answer: "Many days"}, {answer: "Everyday"}];
		var Results;
		function generateQns(qns, id){
			var optcomp = _.template($("#answertemplate").html());
			var qnscomp = _.template($("#questiontemplate").html());
			console.log(qns, id)
			return qnscomp({qns: qns, qnsid: id, optcomp: optcomp});
		}
		$(document).ready(function(){
			_.each(Qns, function(qns){
				qns.options = Ans;
			});

			$("#questions").append(
				_.reduce(Qns, function(memo, qns, id){
					return memo + generateQns(qns, id);
				}, "")
			);
			$("#anxiety-form").on("submit", function(e){
				e.preventDefault();
				Results = $("#anxiety-form").serializeArray();
				console.log(Results);
				if(_.reduce(Qns, function(memo, qns, id){
					if (!$("input[name='"+["question",id].join("-")+"']:checked").val()) {
						$("#"+['question', id, 'wrapper'].join('-')).addClass("redborder");
						return true;
					}
					else{
						$("#"+['question', id, 'wrapper'].join('-')).removeClass("redborder");
					}
					return memo;
				}, false)){
					console.log("failed to pass");
				}
				else{
					renderResults(_.reduce(Results, function(memo, qns){return memo + parseInt(qns.value)}, 0));
					location.hash = "results";
					$('.nav-tabs a[href="#results"]').tab('show');
				}
			});
			$('.nav-tabs a').on('shown', function (e) {
			    //window.location.hash = e.target.hash;
			})
		});
		function renderResults(score){
    		var anxietyStatus = "minimal-anxiety";
    		console.log(score);
			if(score <= 4) anxietyStatus = "minimal-anxiety";
			else if(score <= 9) anxietyStatus = "mild-anxiety";
			else if(score <= 14) anxietyStatus = "moderate-anxiety";
			else if(score <= 21) anxietyStatus = "severe-anxiety";
			$(".results-analysis").not("[id="+anxietyStatus+"]").hide();
			$(".results-analysis #anxietyStatus+").show();
		}
		function resetScreener(){
			location.reload();
		}
		</script>
	</body>
</html>